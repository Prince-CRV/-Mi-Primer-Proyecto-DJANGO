services:
  - type: web
    name: mi-primer-django
    env: python
    plan: free
    buildCommand: |
      python -m pip install --upgrade pip
      pip install -r app/requirements.txt
      # 1. Borramos la DB para limpiar el historial
      rm -f app/db.sqlite3
      # 2. Borramos SOLO tus migraciones (dentro de la carpeta app)
      # Esto evita tocar los archivos internos de la librer√≠a 'django'
      find app -path "*/migrations/*.py" -not -name "__init__.py" -delete
      # 3. Regeneramos todo
      python app/manage.py makemigrations
      python app/manage.py migrate
      python app/manage.py collectstatic --noinput
    startCommand: "gunicorn --chdir app config.wsgi:application"
    envVars:
      - key: PYTHON_VERSION
        value: 3.12.8
      - key: DJANGO_SETTINGS_MODULE
        value: config.settings
      - key: SECRET_KEY
        generateValue: true
